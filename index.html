<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GỬI HÂN</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Cormorant+Garamond:ital,wght@1,500&family=Montserrat:wght@300&display=swap" rel="stylesheet">
    <style>
        /* --- 1. THIẾT LẬP KHÔNG GIAN --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            /* Nền Gradient Đêm Huyền Ảo */
            background: radial-gradient(circle at center, #2b1055 0%, #7597de 100%); /* Fallback */
            background: linear-gradient(135deg, #1f002b 0%, #3b0042 50%, #0d001a 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: none; /* Ẩn con trỏ chuột mặc định để dùng hiệu ứng hạt */
        }

        /* --- CÁC LỚP CANVAS --- */
        #bg-canvas { position: absolute; top: 0; left: 0; z-index: 0; } /* Nền sao & Bokeh */
        #heart-canvas { position: absolute; top: 0; left: 0; z-index: 5; pointer-events: none;} /* Trái tim */
        #cursor-canvas { position: absolute; top: 0; left: 0; z-index: 9999; pointer-events: none;} /* Hiệu ứng chuột */

        /* --- 2. PHONG BÌ 3D CAO CẤP --- */
        .envelope-wrapper {
            position: relative;
            z-index: 10;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .envelope {
            position: relative;
            width: 340px; height: 240px;
            background: linear-gradient(to bottom right, #9e1f48, #750d30);
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
            border-radius: 6px;
            cursor: pointer;
        }

        /* Hiệu ứng "Thở" mời gọi click */
        .envelope-wrapper:not(.open) {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* Nắp phong bì */
        .front-flap {
            position: absolute; width: 0; height: 0;
            border-left: 170px solid transparent; border-right: 170px solid transparent;
            border-bottom: 140px solid #b82e5c; /* Sáng hơn thân */
            bottom: 0; left: 0; z-index: 3;
            border-radius: 0 0 6px 6px;
        }

        .top-flap {
            position: absolute; width: 0; height: 0;
            border-left: 170px solid transparent; border-right: 170px solid transparent;
            border-top: 140px solid #d6457a; /* Nắp trên sáng nhất */
            top: 0; left: 0; transform-origin: top;
            transition: transform 0.8s 0.2s, z-index 0.2s;
            z-index: 4;
            border-radius: 6px 6px 0 0;
        }

        /* Con dấu sáp phát sáng */
        .wax-seal {
            position: absolute; top: 75px; left: 50%; transform: translate(-50%, 0);
            width: 55px; height: 55px;
            background: radial-gradient(circle at 30% 30%, #ffd700, #cfa500);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); /* Glow vàng */
            z-index: 5; display: flex; justify-content: center; align-items: center;
            font-size: 30px; color: #7a4d0f; 
            transition: opacity 0.5s, transform 0.3s;
        }
        .envelope:hover .wax-seal { transform: translate(-50%, 0) scale(1.1); }

        /* --- 3. LÁ THƯ GLASSMORPHISM (Kính mờ) --- */
        .letter {
            position: absolute; width: 300px; height: 450px;
            /* Hiệu ứng kính mờ sang trọng */
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            top: 10px; left: 20px; border-radius: 8px; padding: 30px; z-index: 2;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1) 0.6s;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            opacity: 0; /* Ẩn lúc đầu */
        }
        
        /* Viền vàng trang trí */
        .letter::after {
            content: ""; position: absolute; top: 15px; left: 15px; right: 15px; bottom: 15px;
            border: 1px solid rgba(212, 175, 55, 0.5); pointer-events: none;
        }

        .letter-content { opacity: 0; transition: opacity 1s 1.8s; width: 100%; height: 100%; display: flex; flex-direction: column;}
        
        .letter h1 { 
            font-family: 'Dancing Script', cursive; 
            background: linear-gradient(to right, #d4145a, #fbb03b);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 20px; font-size: 36px; font-weight: 700;
        }
        
        .letter p { 
            font-family: 'Cormorant Garamond', serif;
            font-size: 18px; line-height: 1.6; color: #444; font-weight: 600; font-style: italic;
            text-align: justify;
        }
        
        .signature {
            font-family: 'Dancing Script', cursive; font-size: 26px;
            color: #cfa500; margin-top: auto;
        }

        /* --- TRẠNG THÁI MỞ --- */
        .envelope-wrapper.open .top-flap { transform: rotateX(180deg); z-index: 1; }
        .envelope-wrapper.open .wax-seal { opacity: 0; }
        .envelope-wrapper.open .letter { transform: translateY(-220px); z-index: 11; opacity: 1; }
        .envelope-wrapper.open .letter-content { opacity: 1; }
        
        /* Hướng dẫn */
        .instruction {
            position: absolute; bottom: 50px; color: rgba(255,255,255,0.6);
            font-family: 'Montserrat', sans-serif; font-size: 10px; letter-spacing: 4px; text-transform: uppercase;
            animation: fadeBlink 2s infinite; pointer-events: none;
        }
        @keyframes fadeBlink { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.8; } }

        /* Nút nhạc */
        .music-control {
            position: absolute; bottom: 20px; right: 20px; width: 40px; height: 40px;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3);
            color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center;
            cursor: pointer; z-index: 10000; font-size: 16px; transition: 0.3s;
        }
        .music-control:hover { background: rgba(255,0,80,0.6); box-shadow: 0 0 15px #ff0050; }
        .music-control.playing { animation: spin 5s linear infinite; border-color: #ff8ba7; color: #ff8ba7; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>
    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mp3">
    </audio>

    <canvas id="bg-canvas"></canvas>
    <canvas id="heart-canvas"></canvas>
    <canvas id="cursor-canvas"></canvas> <div class="envelope-wrapper" id="envelopeWrapper">
        <div class="envelope" onclick="openSurprise()">
            <div class="front-flap"></div><div class="top-flap"></div><div class="wax-seal">❤</div>
            <div class="letter">
                <div class="letter-content">
                    <h1>My Love,</h1>
                    <p id="typewriter-text"></p>
                    <div class="signature">Forever yours.</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="instruction" id="instruct">Click to Open</div>
    <div class="music-control" id="musicBtn" onclick="toggleMusic()">♫</div>

    <script>
        // --- NỘI DUNG LỜI CHÚC ---
        const message = "Anh yêu em rất nhiều, anh mong rằng chúng ta sẽ luôn nắm tay nhau trên quãng đường dài phía trước. Happy Valentine's Day, công chúa bé nhỏ!";
        
        // --- JS LOGIC ---
        let isOpen = false;
        const audio = document.getElementById('bg-music');
        const musicBtn = document.getElementById('musicBtn');
        const wrapper = document.getElementById('envelopeWrapper');
        const heartCanvas = document.getElementById('heart-canvas');
        const instruct = document.getElementById('instruct');

        function openSurprise() {
            if (isOpen) return; isOpen = true;
            wrapper.classList.add('open');
            instruct.style.display = 'none';
            audio.volume = 0.5;
            audio.play().then(() => musicBtn.classList.add('playing')).catch(e => console.log("Click music btn manually"));
            
            setTimeout(typeWriter, 1500);
            
            // Hiện trái tim và kích hoạt hiệu ứng nền mạnh hơn
            setTimeout(() => { 
                heartCanvas.style.opacity = "1"; 
                loopHeart(); 
                spawnFireflies(); // Thêm đom đóm
            }, 1000); 
        }

        function toggleMusic() {
            if (audio.paused) { audio.play(); musicBtn.classList.add('playing'); } 
            else { audio.pause(); musicBtn.classList.remove('playing'); }
        }

        let i = 0; const textElement = document.getElementById("typewriter-text");
        function typeWriter() {
            if (i < message.length) { 
                textElement.innerHTML += message.charAt(i); 
                i++; 
                setTimeout(typeWriter, 50); 
            }
        }

        // --- CANVAS SETUP ---
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        const heartCtx = heartCanvas.getContext('2d');
        const cursorCanvas = document.getElementById('cursor-canvas');
        const cursorCtx = cursorCanvas.getContext('2d');

        let width, height;
        function resize() { 
            width = window.innerWidth; height = window.innerHeight; 
            bgCanvas.width = width; bgCanvas.height = height; 
            heartCanvas.width = width; heartCanvas.height = height;
            cursorCanvas.width = width; cursorCanvas.height = height;
        }
        window.addEventListener('resize', resize); resize();

        // 1. MOUSE TRAIL EFFECT (HẠT BỤI TIÊN THEO CHUỘT)
        let mouseParticles = [];
        let mouse = { x: undefined, y: undefined };
        window.addEventListener('mousemove', (e) => { mouse.x = e.x; mouse.y = e.y; for(let i=0; i<3; i++) createMouseParticle(); });

        class MouseParticle {
            constructor() {
                this.x = mouse.x; this.y = mouse.y;
                this.size = Math.random() * 3 + 1;
                this.speedX = Math.random() * 2 - 1; this.speedY = Math.random() * 2 - 1;
                this.color = `hsl(${Math.random() * 60 + 30}, 100%, 70%)`; // Gold/Yellow colors
            }
            update() { this.x += this.speedX; this.y += this.speedY; if (this.size > 0.1) this.size -= 0.05; }
            draw() { cursorCtx.fillStyle = this.color; cursorCtx.beginPath(); cursorCtx.arc(this.x, this.y, this.size, 0, Math.PI*2); cursorCtx.fill(); }
        }
        function createMouseParticle() { mouseParticles.push(new MouseParticle()); }
        function handleMouseParticles() {
            cursorCtx.clearRect(0,0,width,height);
            for (let i=0; i<mouseParticles.length; i++) {
                mouseParticles[i].update(); mouseParticles[i].draw();
                if (mouseParticles[i].size <= 0.1) { mouseParticles.splice(i, 1); i--; }
            }
            requestAnimationFrame(handleMouseParticles);
        }
        handleMouseParticles();

        // 2. BACKGROUND BOKEH & STARS (NỀN ẢO DIỆU)
        let bgParticles = [];
        for(let j=0; j<100; j++) bgParticles.push({
            x: Math.random()*width, y: Math.random()*height, 
            size: Math.random()*3, 
            speedY: Math.random()*0.5,
            opacity: Math.random()*0.5,
            type: Math.random() > 0.8 ? 'bokeh' : 'star' // 20% là bokeh to, 80% là sao nhỏ
        });

        function drawBg() {
            bgCtx.clearRect(0, 0, width, height);
            bgParticles.forEach(p => {
                p.y -= p.speedY; if (p.y < 0) p.y = height;
                
                bgCtx.beginPath();
                if (p.type === 'bokeh') {
                    // Hiệu ứng đốm sáng mờ (Bokeh)
                    bgCtx.fillStyle = `rgba(255, 100, 150, ${p.opacity * 0.3})`;
                    bgCtx.arc(p.x, p.y, p.size * 10, 0, Math.PI*2);
                } else {
                    // Sao lấp lánh
                    bgCtx.fillStyle = "rgba(255, 255, 255, 0.8)";
                    bgCtx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                }
                bgCtx.fill();
            });
            requestAnimationFrame(drawBg);
        }
        drawBg();

        // 3. MAGICAL HEART (TRÁI TIM PHÁO HOA)
        let particles = [];
        function getHeartPoint(t) { return { x: 16 * Math.pow(Math.sin(t), 3), y: -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) }; }
        
        class HeartParticle {
            constructor() {
                let t = Math.random() * Math.PI * 2; let point = getHeartPoint(t); let scale = Math.min(width, height) / 28;
                this.originX = point.x * scale + width / 2; this.originY = point.y * scale + height / 2 - 30;
                this.x = this.originX; this.y = this.originY;
                this.size = Math.random() * 1.5;
                // Màu Gradient từ Vàng -> Hồng -> Tím
                let hue = Math.random() * 60 + 300; // 300-360 (Hồng/Tím) & 0-40 (Đỏ/Cam)
                this.color = `hsla(${hue}, 80%, 60%, ${Math.random()*0.8+0.2})`;
                this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.5;
            }
            update(time) {
                // Rung động nhẹ như dải lụa
                this.x = this.originX + Math.sin(time + this.y * 0.05) * 5;
                this.y = this.originY + Math.cos(time + this.x * 0.05) * 5;
            }
            draw() {
                heartCtx.fillStyle = this.color; heartCtx.beginPath(); heartCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2); heartCtx.fill();
            }
        }
        function initHeart() { for (let i = 0; i < 700; i++) particles.push(new HeartParticle()); }
        initHeart();

        let time = 0;
        function loopHeart() {
            heartCtx.clearRect(0, 0, width, height);
            particles.forEach(p => { p.update(time); p.draw(); });
            time += 0.03; requestAnimationFrame(loopHeart);
        }

        // 4. FIREFLIES (ĐOM ĐÓM BAY LÊN SAU KHI MỞ)
        function spawnFireflies() {
            for(let k=0; k<30; k++) {
                bgParticles.push({
                    x: Math.random()*width, y: height + Math.random()*200,
                    size: Math.random()*2, speedY: Math.random()*1 + 0.5,
                    opacity: 1, type: 'firefly'
                });
            }
        }

    </script>
</body>
</html>